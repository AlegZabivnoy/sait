/**
 * main.js - –õ–æ–≥—ñ–∫–∞ –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
 * 
 * –¶–µ–π —Ñ–∞–π–ª –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∫–≤—ñ–∑—ñ–≤ –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ.
 * –¢—É—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –æ—Å–Ω–æ–≤–Ω—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó —Ä–æ–±–æ—Ç–∏ –∑ DOM —Ç–∞ localStorage.
 * 
 * –ù–∞–≤—á–∞–ª—å–Ω—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó:
 * - –†–æ–±–æ—Ç–∞ –∑ DOM API (getElementById, createElement, appendChild)
 * - –¶–∏–∫–ª forEach –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä—É –º–∞—Å–∏–≤—ñ–≤
 * - –î–∏–Ω–∞–º—ñ—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è HTML –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
 * - –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è template literals –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó HTML
 */

// –ì–ª–æ–±–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ—ó –º–æ–≤–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
// TODO: –í –º–∞–π–±—É—Ç–Ω—å–æ–º—É –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É –º—É–ª—å—Ç–∏–º–æ–≤–Ω–æ—Å—Ç—ñ
let currentLanguage = 'uk';

/**
 * –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
 * –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–¥–∏–≤. –∫—ñ–Ω–µ—Ü—å —Ñ–∞–π–ª—É)
 */
function initMainPage() {
    console.log('–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏...');
    loadQuizzes(); // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –∫–≤—ñ–∑–∏
}

/**
 * –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–≤—ñ–∑—ñ–≤
 * 
 * –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–æ–±–æ—Ç–∏:
 * 1. –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –∫–≤—ñ–∑–∏ –∑ localStorage —á–µ—Ä–µ–∑ storageService
 * 2. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –∫–≤—ñ–∑–∏
 * 3. –Ø–∫—â–æ –Ω–µ–º–∞—î - –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è "–ü–æ–∫–∏ –Ω–µ–º–∞—î –∫–≤—ñ–∑—ñ–≤"
 * 4. –Ø–∫—â–æ —î - —Å—Ç–≤–æ—Ä—é—î–º–æ –∫–∞—Ä—Ç–∫—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–≤—ñ–∑—É
 */
function loadQuizzes() {
    // –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –∫–≤—ñ–∑–∏ –∑ localStorage
    const quizzes = storageService.getAllQuizzes();
    
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –∑–∞ —ó—Ö ID
    const quizList = document.getElementById('quiz-list');
    const emptyState = document.getElementById('empty-state');

    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –∫–≤—ñ–∑–∏ –≤ —Å–∏—Å—Ç–µ–º—ñ
    if (quizzes.length === 0) {
        // –Ø–∫—â–æ –∫–≤—ñ–∑—ñ–≤ –Ω–µ–º–∞—î - —Ö–æ–≤–∞—î–º–æ —Å–ø–∏—Å–æ–∫ —ñ –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç–∞–Ω
        quizList.style.display = 'none';
        emptyState.style.display = 'block';
        return; // –í–∏—Ö–æ–¥–∏–º–æ –∑ —Ñ—É–Ω–∫—Ü—ñ—ó
    }

    // –Ø–∫—â–æ –∫–≤—ñ–∑–∏ —î - –ø–æ–∫–∞–∑—É—î–º–æ —Å–ø–∏—Å–æ–∫ —ñ —Ö–æ–≤–∞—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç–∞–Ω
    quizList.style.display = 'grid';
    emptyState.style.display = 'none';
    
    // –û—á–∏—â—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –≤–º—ñ—Å—Ç —Å–ø–∏—Å–∫—É (–≤–∞–∂–ª–∏–≤–æ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ!)
    quizList.innerHTML = '';

    // –ü–µ—Ä–µ–±–∏—Ä–∞—î–º–æ –≤—Å—ñ –∫–≤—ñ–∑–∏ —ñ —Å—Ç–≤–æ—Ä—é—î–º–æ –∫–∞—Ä—Ç–∫—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ
    // forEach - –º–µ—Ç–æ–¥ –º–∞—Å–∏–≤—É, —è–∫–∏–π –≤–∏–∫–æ–Ω—É—î —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç—É
    quizzes.forEach(quiz => {
        const quizCard = createQuizCard(quiz); // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–∞—Ä—Ç–∫—É –∫–≤—ñ–∑—É
        quizList.appendChild(quizCard);         // –î–æ–¥–∞—î–º–æ –∫–∞—Ä—Ç–∫—É –¥–æ —Å–ø–∏—Å–∫—É
    });
}

/**
 * –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–∞—Ä—Ç–∫—É –∫–≤—ñ–∑—É (DOM –µ–ª–µ–º–µ–Ω—Ç)
 * 
 * –¶—è —Ñ—É–Ω–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä—é—î HTML-–∫–∞—Ä—Ç–∫—É –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–≤—ñ–∑—É –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ.
 * –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î template literals (–∑–≤–æ—Ä–æ—Ç–Ω—ñ –ª–∞–ø–∫–∏ `) –¥–ª—è –∑—Ä—É—á–Ω–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è HTML.
 * 
 * @param {Quiz} quiz - –û–±'—î–∫—Ç –∫–≤—ñ–∑—É –∑ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—è–º–∏ name, description, questions
 * @returns {HTMLElement} - –ì–æ—Ç–æ–≤–∏–π DOM –µ–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç–∫–∏
 * 
 * –ù–∞–≤—á–∞–ª—å–Ω—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó:
 * - createElement() - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ DOM –µ–ª–µ–º–µ–Ω—Ç–∞
 * - innerHTML - –≤—Å—Ç–∞–≤–∫–∞ HTML –∫–æ–¥—É —è–∫ —Ä—è–¥–∫–∞
 * - Template literals - –∑—Ä—É—á–Ω–∏–π —Å–ø–æ—Å—ñ–± —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–∞–≥–∞—Ç–æ—Ä—è–¥–∫–æ–≤–∏—Ö —Ä—è–¥–∫—ñ–≤
 * - –¢–µ—Ä–Ω–∞—Ä–Ω–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä (? :) - –∫–æ—Ä–æ—Ç–∫–∞ —Ñ–æ—Ä–º–∞ if-else
 * - escapeHtml() - –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ XSS –∞—Ç–∞–∫
 */
function createQuizCard(quiz) {
    // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π div –µ–ª–µ–º–µ–Ω—Ç –¥–ª—è –∫–∞—Ä—Ç–∫–∏
    const card = document.createElement('div');
    
    // –î–æ–¥–∞—î–º–æ CSS –∫–ª–∞—Å –¥–ª—è —Å—Ç–∏–ª—ñ–∑–∞—Ü—ñ—ó
    card.className = 'quiz-card';
    
    // –ü—ñ–¥—Ä–∞—Ö–æ–≤—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–∏—Ç–∞–Ω—å (—è–∫—â–æ –ø–∏—Ç–∞–Ω–Ω—è —î)
    // –û–ø–µ—Ä–∞—Ç–æ—Ä ? –ø–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ —ñ—Å–Ω—É—î quiz.questions, —è–∫—â–æ –Ω—ñ - –ø–æ–≤–µ—Ä—Ç–∞—î 0
    const questionCount = quiz.questions ? quiz.questions.length : 0;
    
    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ template literals –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
    // ${} –¥–æ–∑–≤–æ–ª—è—î –≤—Å—Ç–∞–≤–ª—è—Ç–∏ JavaScript –≤–∏—Ä–∞–∑–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—É —Ä—è–¥–∫–∞
    card.innerHTML = `
        <div class="quiz-card-header">
            <h3 class="quiz-name">${escapeHtml(quiz.name)}</h3>
        </div>
        <div class="quiz-card-body">
            <p class="quiz-description">${escapeHtml(quiz.description)}</p>
            <p class="quiz-info">
                <span class="quiz-questions-count">üìù ${questionCount} –ø–∏—Ç–∞–Ω—å${questionCount === 1 ? '–Ω—è' : ''}</span>
            </p>
        </div>
        <div class="quiz-card-footer">
            <button onclick="startQuiz('${escapeHtml(quiz.name)}')" class="go-to-quiz-btn">
                –ü—Ä–æ–π—Ç–∏ –∫–≤—ñ–∑ ‚Üí
            </button>
        </div>
    `;
    
    // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –≥–æ—Ç–æ–≤—É –∫–∞—Ä—Ç–∫—É
    return card;
}

/**
 * –ü–æ—á–∞—Ç–∏ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –∫–≤—ñ–∑—É
 * 
 * –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–π—Ç–∏ –∫–≤—ñ–∑"
 * –í–æ–Ω–∞ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –∫–≤—ñ–∑ –∑–∞ –Ω–∞–∑–≤–æ—é, –∑–±–µ—Ä—ñ–≥–∞—î –π–æ–≥–æ —è–∫ –≤–∏–±—Ä–∞–Ω–∏–π —ñ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è
 * 
 * @param {string} quizName - –ù–∞–∑–≤–∞ –∫–≤—ñ–∑—É, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–æ–π—Ç–∏
 * 
 * –ù–∞–≤—á–∞–ª—å–Ω—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó:
 * - –£–º–æ–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∏ (if-else)
 * - –†–µ–¥—ñ—Ä–µ–∫—Ç –º—ñ–∂ —Å—Ç–æ—Ä—ñ–Ω–∫–∞–º–∏ (window.location.href)
 * - –ë–∞–∑–æ–≤–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
 */
function startQuiz(quizName) {
    // –®—É–∫–∞—î–º–æ –∫–≤—ñ–∑ –∑–∞ –Ω–∞–∑–≤–æ—é –≤ localStorage
    const quiz = storageService.getQuizByName(quizName);
    
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∑–Ω–∞–π–¥–µ–Ω–æ –∫–≤—ñ–∑
    if (quiz) {
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∫–≤—ñ–∑ —è–∫ –≤–∏–±—Ä–∞–Ω–∏–π (—â–æ–± –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –∑–Ω–∞—Ç–∏, —è–∫–∏–π –∫–≤—ñ–∑ –ø—Ä–æ—Ö–æ–¥–∏–º–æ)
        storageService.setSelectedQuiz(quiz);
        
        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –∫–≤—ñ–∑—É
        window.location.href = 'quiz/index.html';
    } else {
        // –Ø–∫—â–æ –∫–≤—ñ–∑ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ - –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–º–∏–ª–∫—É
        alert('–ö–≤—ñ–∑ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!');
    }
}

/**
 * –ó–º—ñ–Ω–∏—Ç–∏ –º–æ–≤—É —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
 * 
 * @param {string} lang - –ö–æ–¥ –º–æ–≤–∏ ('uk' –∞–±–æ 'en')
 * 
 * TODO –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤: –†–µ–∞–ª—ñ–∑—É–π—Ç–µ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É –º—É–ª—å—Ç–∏–º–æ–≤–Ω–æ—Å—Ç—ñ
 * –ü—ñ–¥–∫–∞–∑–∫–∞: —Å—Ç–≤–æ—Ä—ñ—Ç—å –æ–±'—î–∫—Ç –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–∞–º–∏ —ñ –∑–∞–º—ñ–Ω—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
 */
function changeLanguage(lang) {
    currentLanguage = lang;
    // TODO: –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
    console.log('–ú–æ–≤—É –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞:', lang);
}

/**
 * –ï–∫—Ä–∞–Ω—É–≤–∞—Ç–∏ HTML –¥–ª—è –±–µ–∑–ø–µ–∫–∏
 * 
 * –í–∞–∂–ª–∏–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ XSS (Cross-Site Scripting) –∞—Ç–∞–∫!
 * –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ —Å–∏–º–≤–æ–ª–∏ HTML (<, >, &, ", ') —É –±–µ–∑–ø–µ—á–Ω—ñ –∫–æ–¥–∏
 * 
 * –ü—Ä–∏–∫–ª–∞–¥: "<script>alert('hack')</script>" -> "&lt;script&gt;alert('hack')&lt;/script&gt;"
 * 
 * @param {string} text - –¢–µ–∫—Å—Ç, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –µ–∫—Ä–∞–Ω—É–≤–∞—Ç–∏
 * @returns {string} - –ë–µ–∑–ø–µ—á–Ω–∏–π —Ç–µ–∫—Å—Ç –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ HTML
 * 
 * –ù–∞–≤—á–∞–ª—å–Ω—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó:
 * - –ë–µ–∑–ø–µ–∫–∞ –≤–µ–±-–∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤ (XSS prevention)
 * - –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è textContent –∑–∞–º—ñ—Å—Ç—å innerHTML –¥–ª—è –±–µ–∑–ø–µ–∫–∏
 */
function escapeHtml(text) {
    // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∏–º—á–∞—Å–æ–≤–∏–π div –µ–ª–µ–º–µ–Ω—Ç
    const div = document.createElement('div');
    
    // textContent –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –µ–∫—Ä–∞–Ω—É—î –≤—Å—ñ HTML —Å–∏–º–≤–æ–ª–∏
    div.textContent = text;
    
    // innerHTML –ø–æ–≤–µ—Ä—Ç–∞—î –µ–∫—Ä–∞–Ω–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç —É —Ñ–æ—Ä–º–∞—Ç—ñ HTML
    return div.innerHTML;
}

// ====================================
// –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø –î–û–î–ê–¢–ö–£
// ====================================

/**
 * –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î–º–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
 * window.onload - –ø–æ–¥—ñ—è, —è–∫–∞ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –∫–æ–ª–∏ –≤—Å—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞
 * 
 * –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏:
 * - DOMContentLoaded - —Å–ø—Ä–∞—Ü—å–æ–≤—É—î —à–≤–∏–¥—à–µ (–∫–æ–ª–∏ HTML –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π, –±–µ–∑ –∫–∞—Ä—Ç–∏–Ω–æ–∫)
 * - document.addEventListener('DOMContentLoaded', initMainPage)
 */
window.onload = initMainPage;

